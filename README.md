# AppSec Guide

API to help developers prioritize which security issues to fix first. Fetches vulnerability data from NAIS, enriches with CISA KEV catalog, and returns prioritized results.

## Prerequisites
- Java 21
- Gradle 8.x
- Docker (for Valkey cache in tests)

## Environment Variables

- `NAIS_TOKEN_INTROSPECTION_ENDPOINT` - Token introspection endpoint (required)
- `NAIS_API_URL` - NAIS GraphQL API endpoint (required)
- `NAIS_API_TOKEN` - NAIS API token (required)
- `VALKEY_HOST` - Valkey host (default: localhost)
- `VALKEY_PORT` - Valkey port (default: 6379)
- `VALKEY_USERNAME` - Valkey username (optional)
- `VALKEY_PASSWORD` - Valkey password (optional)
- `CACHE_TTL_MINUTES` - Cache TTL in minutes (default: 60)

## Running Locally

```bash
export NAIS_TOKEN_INTROSPECTION_ENDPOINT="https://your-endpoint"
export NAIS_API_URL="https://console.nav.cloud.nais.io/query"
export NAIS_API_TOKEN="your-token"
./gradlew run
```

Application starts on `http://localhost:8080`

## Testing

```bash
./gradlew test
```

Tests use mocked dependencies and testcontainers for Valkey.

## API Endpoints

### Health
- `GET /isalive` - Liveness probe
- `GET /isready` - Readiness probe

### Vulnerabilities
- `GET /vulnerabilities/user` - Get vulnerabilities for authenticated user

All endpoints except health checks require Bearer token authentication.

## Authentication

Endpoints require a valid JWT Bearer token with:
- `NAVident` claim for user identification
- `preferred_username` claim for email

```bash
curl -H "Authorization: Bearer <token>" http://localhost:8080/vulnerabilities/user
```

## API Documentation
## License

This project is licensed under the MIT License - see the [LICENSE.md](LICENSE.md) file for details.

## Contact

For any questions, issues, or feature requests, please reach out to the AppSec team:
- Internal: Either our slack channel [#appsec](https://nav-it.slack.com/archives/C06P91VN27M) or contact a [team member](https://teamkatalogen.nav.no/team/02ed767d-ce01-49b5-9350-ee4c984fd78f) directly via slack/teams/mail.
- External: [Open GitHub Issue](https://github.com/navikt/appsec-guide/issues/new/choose)

## Code generated by GitHub Copilot

This project was developed with the assistance of GitHub Copilot, an AI-powered code completion tool.