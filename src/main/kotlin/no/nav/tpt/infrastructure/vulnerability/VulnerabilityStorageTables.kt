package no.nav.tpt.infrastructure.vulnerability

import kotlinx.serialization.json.Json
import org.jetbrains.exposed.sql.Table
import org.jetbrains.exposed.sql.javatime.timestamp
import org.jetbrains.exposed.sql.json.json

object VulnerabilityTracking : Table("vulnerability_tracking") {
    val id = integer("id").autoIncrement()
    
    // Team context
    val teamSlug = varchar("team_slug", 100)
    val teamSlackChannel = varchar("team_slack_channel", 100).nullable()
    
    // Application context
    val appNaisId = varchar("app_nais_id", 255)
    val appName = varchar("app_name", 255)
    val appWorkloadType = varchar("app_workload_type", 20)
    val appEnvironment = varchar("app_environment", 100).nullable()
    val appRepository = varchar("app_repository", 500).nullable()
    val appImageName = varchar("app_image_name", 500).nullable()
    val appImageTag = varchar("app_image_tag", 255).nullable()
    val appHasExternalIngress = bool("app_has_external_ingress")
    val appIngressTypes = json<List<String>>("app_ingress_types", Json.Default).nullable()
    
    // Vulnerability data
    val cveId = varchar("cve_id", 20)
    val packageName = varchar("package_name", 255).nullable()
    val severity = varchar("severity", 20).nullable()
    val description = text("description").nullable()
    val vulnerabilityDetailsLink = text("vulnerability_details_link").nullable()
    val suppressed = bool("suppressed")
    
    // Timestamps
    val discoveredAt = timestamp("discovered_at")
    val lastSeenAt = timestamp("last_seen_at")
    val resolvedAt = timestamp("resolved_at").nullable()
    val syncTimestamp = timestamp("sync_timestamp")
    val createdAt = timestamp("created_at")
    val updatedAt = timestamp("updated_at")

    override val primaryKey = PrimaryKey(id)
}
