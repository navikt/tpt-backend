package no.nav.tpt.domain.vulnerability

import java.time.Instant

interface VulnerabilityRepository {
    suspend fun upsertVulnerability(vulnerability: VulnerabilityTrackingData): VulnerabilityTrackingData
    
    suspend fun searchVulnerabilities(
        cveId: String? = null,
        teamSlug: String? = null,
        severities: List<String>? = null,
        hasExternalIngress: Boolean? = null,
        suppressed: Boolean? = null,
        limit: Int = 50,
        offset: Int = 0
    ): Pair<List<VulnerabilitySearchResult>, Int>
    
    suspend fun getActiveVulnerabilitiesForTeams(teamSlugs: List<String>): List<VulnerabilitySearchResult>
    
    suspend fun deleteOldDataForTeam(teamSlug: String, beforeTimestamp: Instant): Int
}

data class VulnerabilitySearchResult(
    val cveId: String,
    val teamSlug: String,
    val applicationName: String,
    val applicationNaisId: String,
    val workloadType: String,
    val environment: String?,
    val repository: String?,
    val imageTag: String?,
    val ingressTypes: List<String>,
    val packageName: String?,
    val severity: String?,
    val description: String?,
    val vulnerabilityDetailsLink: String?,
    val hasExternalIngress: Boolean,
    val suppressed: Boolean,
    val discoveredAt: Instant,
    val lastSeenAt: Instant
)
